{"version":3,"file":"StateManagerService.class.js","sourceRoot":"","sources":["../../../src/dist/services/StateManagerService.class.js"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ui_router_ng2_1 = require(\"ui-router-ng2\");\n/** A stateful connection to ui-router history\n - .stateChange() with arguments MUST be called at every state change\n*/\nvar StateManagerService = (function () {\n    //constructor($state, $window){\n    function StateManagerService($state, $window) {\n        this.$state = $state;\n        this.$window = $window || window;\n        //inject(arguments, this)\n        this.stateHistory = [];\n        this.hisPos = 0;\n    }\n    StateManagerService.prototype.isBackHistory = function (toState, toParams) {\n        var isEven = this.stateHistory.length > this.hisPos;\n        var isNameMatch = isEven && toState && toState.name == this.stateHistory[this.hisPos].name;\n        return isNameMatch && this.isParamsMatch(toParams, this.stateHistory[this.hisPos].params);\n    };\n    StateManagerService.prototype.isForwardHistory = function (toState, toParams) {\n        var isEven = !this.isNextBackMode && this.hisPos && this.stateHistory.length > this.hisPos;\n        var isNameMatch = isEven && toState && toState.name == this.stateHistory[this.hisPos - 1].name;\n        return isNameMatch && this.isParamsMatch(toParams, this.stateHistory[this.hisPos - 1].params);\n    };\n    StateManagerService.prototype.isParamsMatch = function (toParams, otherParams) {\n        for (var x in toParams) {\n            if (toParams[x] != otherParams[x]) {\n                return false;\n            }\n        }\n        return true;\n    };\n    /**\n      @event Object - not used\n      @toState Object{name} - required\n      @toParams Object{} - only recorded to history, not used otherwise\n      @fromState Object{name} - not used\n      @fromParams Object{} - not used\n    */\n    StateManagerService.prototype.stateChange = function (event, toState, toParams, fromState, fromParams) {\n        this.recordStateChange(toState, toParams);\n    };\n    StateManagerService.prototype.recordStateChange = function (toState, toParams) {\n        var isFowardHistory = this.isForwardHistory(toState, toParams);\n        var isBackHistory = this.isNextBackHistory || this.isBackHistory(toState, toParams);\n        this.isBackMode = this.isNextBackMode || (this.isOsAction && isBackHistory);\n        if (isFowardHistory) {\n            this.isBackMode = false;\n            --this.hisPos;\n        }\n        else if (this.isBackMode) {\n            ++this.hisPos;\n        }\n        else {\n            this.hisPos = 0;\n            this.stateHistory.unshift({\n                name: this.$state.current.name,\n                state: this.$state.current,\n                params: this.$state.params\n                //params:fromParams\n            });\n        }\n        this.isNextBackHistory = false;\n    };\n    StateManagerService.prototype.goBackTo = function (name, params) {\n        this.isNextBackMode = true;\n        this.isNextBackHistory = true;\n        this.$state.go(name, params);\n    };\n    StateManagerService.prototype.tryBack = function (name, params) {\n        if (this.stateHistory.length) {\n            this.isNextBackMode = true;\n            this.isNextBackHistory = true;\n            this.$window.history.back();\n            /*\n            console.log('go back', this.hisPos, this.stateHistory.length, this.stateHistory)\n            this.$state.go(this.stateHistory[this.hisPos].name, this.stateHistory[this.hisPos].params)\n            */\n        }\n        else {\n            this.goBackTo(name, params);\n        }\n    };\n    return StateManagerService;\n}());\nStateManagerService.parameters = [[ui_router_ng2_1.StateService]];\nexports.StateManagerService = StateManagerService;\n//# sourceMappingURL=StateManagerService.class.js.map"]}