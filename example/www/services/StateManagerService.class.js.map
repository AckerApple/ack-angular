{"version":3,"file":"StateManagerService.class.js","sourceRoot":"","sources":["../../../src/services/StateManagerService.class.ts"],"names":[],"mappings":";;AAAA,+CAA6C;AAE7C;;EAEE;AACF;IAaE,+BAA+B;IAC/B,6BAAY,MAAM,EAAE,OAAO;QACzB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAA;QACpB,IAAI,CAAC,OAAO,GAAG,OAAO,IAAI,MAAM,CAAA;QAEhC,yBAAyB;QACzB,IAAI,CAAC,YAAY,GAAG,EAAE,CAAA;QACtB,IAAI,CAAC,MAAM,GAAG,CAAC,CAAA;IACjB,CAAC;IAED,2CAAa,GAAb,UAAc,OAAO,EAAE,QAAQ;QAC7B,IAAM,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,GAAC,IAAI,CAAC,MAAM,CAAA;QACnD,IAAM,WAAW,GAAG,MAAM,IAAI,OAAO,IAAI,OAAO,CAAC,IAAI,IAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAA;QAC1F,MAAM,CAAC,WAAW,IAAI,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,CAAA;IAC3F,CAAC;IAED,8CAAgB,GAAhB,UAAiB,OAAO,EAAE,QAAQ;QAChC,IAAM,MAAM,GAAG,CAAC,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,YAAY,CAAC,MAAM,GAAC,IAAI,CAAC,MAAM,CAAA;QAC1F,IAAM,WAAW,GAAG,MAAM,IAAI,OAAO,IAAI,OAAO,CAAC,IAAI,IAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,GAAC,CAAC,CAAC,CAAC,IAAI,CAAA;QAC5F,MAAM,CAAC,WAAW,IAAI,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,GAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAA;IAC7F,CAAC;IAED,2CAAa,GAAb,UAAc,QAAQ,EAAE,WAAW;QACjC,GAAG,CAAA,CAAC,IAAI,CAAC,IAAI,QAAQ,CAAC,CAAA,CAAC;YACrB,EAAE,CAAA,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAE,WAAW,CAAC,CAAC,CAAC,CAAC,CAAA,CAAC;gBAC9B,MAAM,CAAC,KAAK,CAAA;YACd,CAAC;QACH,CAAC;QACD,MAAM,CAAC,IAAI,CAAA;IACb,CAAC;IAED;;;;;;MAME;IACF,yCAAW,GAAX,UAAY,KAAK,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,UAAU;QACzD,IAAI,CAAC,iBAAiB,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAA;IAC3C,CAAC;IAED,+CAAiB,GAAjB,UAAkB,OAAO,EAAE,QAAQ;QACjC,IAAM,eAAe,GAAG,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAA;QAChE,IAAM,aAAa,GAAG,IAAI,CAAC,iBAAiB,IAAI,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAA;QACrF,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,aAAa,CAAC,CAAA;QAE3E,EAAE,CAAA,CAAC,eAAe,CAAC,CAAA,CAAC;YAClB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAA;YACvB,EAAE,IAAI,CAAC,MAAM,CAAA;QACf,CAAC;QAAA,IAAI,CAAC,EAAE,CAAA,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA,CAAC;YACxB,EAAE,IAAI,CAAC,MAAM,CAAA;QACf,CAAC;QAAA,IAAI,CAAA,CAAC;YACJ,IAAI,CAAC,MAAM,GAAG,CAAC,CAAA;YACf,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC;gBACxB,IAAI,EAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI;gBAC7B,KAAK,EAAC,IAAI,CAAC,MAAM,CAAC,OAAO;gBACzB,MAAM,EAAC,IAAI,CAAC,MAAM,CAAC,MAAM;gBACzB,mBAAmB;aACpB,CAAC,CAAA;QACJ,CAAC;QAED,IAAI,CAAC,iBAAiB,GAAG,KAAK,CAAA;IAChC,CAAC;IAED,sCAAQ,GAAR,UAAS,IAAI,EAAE,MAAM;QACnB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAA;QAC1B,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAA;QAC7B,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA;IAC9B,CAAC;IAED,qCAAO,GAAP,UAAQ,IAAI,EAAE,MAAM;QAClB,EAAE,CAAA,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAA,CAAC;YAC3B,IAAI,CAAC,cAAc,GAAG,IAAI,CAAA;YAC1B,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAA;YAC7B,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,EAAE,CAAA;YAC3B;;;cAGE;QACJ,CAAC;QAAA,IAAI,CAAA,CAAC;YACJ,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA;QAC7B,CAAC;IACH,CAAC;IACH,0BAAC;AAAD,CAAC,AAjGD;AAWS,8BAAU,GAAG,CAAC,CAAC,4BAAY,CAAC,CAAC,CAAA;AAXzB,kDAAmB","sourcesContent":["import { StateService } from \"ui-router-ng2\";\n\n/** A stateful connection to ui-router history\n - .stateChange() with arguments MUST be called at every state change\n*/\nexport class StateManagerService{\n  public stateHistory;\n  public $state;\n  public $window;\n  public hisPos : number;\n  public isNextBackMode : boolean\n  public isNextBackHistory : boolean\n  public isBackMode : boolean\n  public isOsAction : boolean\n  public stateService : StateService\n\n  static parameters = [[StateService]]\n\n  //constructor($state, $window){\n  constructor($state, $window){\n    this.$state = $state\n    this.$window = $window || window\n\n    //inject(arguments, this)\n    this.stateHistory = []\n    this.hisPos = 0\n  }\n\n  isBackHistory(toState, toParams){\n    const isEven = this.stateHistory.length>this.hisPos\n    const isNameMatch = isEven && toState && toState.name==this.stateHistory[this.hisPos].name\n    return isNameMatch && this.isParamsMatch(toParams, this.stateHistory[this.hisPos].params)\n  }\n\n  isForwardHistory(toState, toParams){\n    const isEven = !this.isNextBackMode && this.hisPos && this.stateHistory.length>this.hisPos\n    const isNameMatch = isEven && toState && toState.name==this.stateHistory[this.hisPos-1].name\n    return isNameMatch && this.isParamsMatch(toParams, this.stateHistory[this.hisPos-1].params)\n  }\n\n  isParamsMatch(toParams, otherParams){\n    for(let x in toParams){\n      if(toParams[x]!=otherParams[x]){\n        return false\n      }\n    }\n    return true\n  }\n\n  /**\n    @event Object - not used\n    @toState Object{name} - required\n    @toParams Object{} - only recorded to history, not used otherwise\n    @fromState Object{name} - not used\n    @fromParams Object{} - not used\n  */\n  stateChange(event, toState, toParams, fromState, fromParams){\n    this.recordStateChange(toState, toParams)\n  }\n\n  recordStateChange(toState, toParams){\n    const isFowardHistory = this.isForwardHistory(toState, toParams)\n    const isBackHistory = this.isNextBackHistory || this.isBackHistory(toState, toParams)\n    this.isBackMode = this.isNextBackMode || (this.isOsAction && isBackHistory)\n\n    if(isFowardHistory){\n      this.isBackMode = false\n      --this.hisPos\n    }else if(this.isBackMode){\n      ++this.hisPos\n    }else{\n      this.hisPos = 0\n      this.stateHistory.unshift({\n        name:this.$state.current.name,\n        state:this.$state.current,\n        params:this.$state.params\n        //params:fromParams\n      })\n    }\n\n    this.isNextBackHistory = false\n  }\n\n  goBackTo(name, params){\n    this.isNextBackMode = true\n    this.isNextBackHistory = true\n    this.$state.go(name, params)\n  }\n\n  tryBack(name, params){\n    if(this.stateHistory.length){\n      this.isNextBackMode = true\n      this.isNextBackHistory = true\n      this.$window.history.back()\n      /*\n      console.log('go back', this.hisPos, this.stateHistory.length, this.stateHistory)\n      this.$state.go(this.stateHistory[this.hisPos].name, this.stateHistory[this.hisPos].params)\n      */\n    }else{\n      this.goBackTo(name, params)\n    }\n  }\n}"]}