import { Injectable } from '@angular/core';
export class ErrorLog {
    constructor() {
        this.log = [];
        this.maxLog = 30;
    }
    monitorWindow(win) {
        win = win || window;
        const callback = (evt) => this.add(evt, false);
        win.addEventListener('error', callback);
    }
    reject(err) {
        const e = this.add(err);
        return Promise.reject(e);
    }
    rejector() {
        return err => this.reject(err);
    }
    add(e, toConsole) {
        const ob = this.paramAudit(e, toConsole);
        this.log.unshift(ob);
        if (this.maxLog) {
            while (this.log.length > this.maxLog) {
                this.log.pop(); //remove last
            }
        }
        return logObToErrorObject(ob);
    }
    //api error to js Error object
    paramAudit(e, toConsole) {
        if (e.constructor === String) {
            e = new Error(e);
        }
        if (toConsole == null || toConsole)
            console.error(e);
        const err = this.objectifyError(e);
        err['datetime'] = err['datetime'] || getDateTimeString();
        if (!e.message && e.status == -1) {
            e.message = "Cannot connect to server";
            e.details = e.details || "Connection to internet maybe down. Also possible CORS needs be to enabled at remote server.";
        }
        return err;
    }
    /** Convert Error object to a regular object */
    objectifyError(err) {
        const keys = Object.getOwnPropertyNames(err);
        keys.push.apply(keys, Object.keys(err));
        const recErr = {}; //new Error(err.message || err.name || err.type || 'Unexpected Error Occured')
        keys.forEach(v => recErr[v] = err[v]);
        const knownKeys = ["stack", "message", "name", "arguments", "type"];
        knownKeys.forEach(key => {
            if (typeof err[key] != 'undefined') {
                recErr[key] = err[key];
            }
        });
        const body = err.body || err._body;
        //auto attempt to parse body
        if (body && !err.data && err.headers) {
            const contentType = err.headers.get('content-type');
            if (contentType && contentType.toLowerCase() == 'application/json') {
                try {
                    recErr.data = JSON.parse(body);
                }
                catch (e) { }
            }
        }
        return recErr;
    }
    /** same as reject but uses native throw instead of native Promise.reject */
    rethrow(err) {
        const e = this.add(err);
        throw e;
    }
}
ErrorLog.decorators = [
    { type: Injectable }
];
function getErrorMessage(err) {
    return err.message || err.statusText || err.name || 'Unexpected Error Occured';
}
function getResponseMessage(res) {
    if (res.data && res.data.error && res.data.error.message) {
        return res.data.error.message;
    }
    return getErrorMessage(res);
}
function logObToErrorObject(log) {
    const e = new Error(getResponseMessage(log));
    Object.keys(log).forEach(v => e[v] = log[v]);
    return e;
}
function getDateTimeString() {
    return (function (d) { return (('0' + (d.getMonth() + 1)).slice(-2) + '/' + ('0' + d.getDate()).slice(-2) + '/' + d.getFullYear()); })(new Date()) + ' ' + (function (d) { var h = d.getHours(), t = 'AM', m = d.getMinutes(); var mn = m < 10 ? '0' + m : m; h = h >= 12 ? (t = 'PM', h - 12 || 12) : h == 0 ? 12 : h; return ('0' + h).slice(-2) + ':' + ('0' + mn).slice(-2) + ' ' + t; })(new Date());
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXJyb3JMb2cuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vc3JjLyIsInNvdXJjZXMiOlsicHJvdmlkZXJzL0Vycm9yTG9nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFN0IsTUFBTSxPQUFPLFFBQVE7SUFBbkM7UUFDUyxRQUFHLEdBQUcsRUFBRSxDQUFBO1FBQ1IsV0FBTSxHQUFHLEVBQUUsQ0FBQTtJQWtGcEIsQ0FBQztJQWhGQyxhQUFhLENBQUMsR0FBSTtRQUNoQixHQUFHLEdBQUcsR0FBRyxJQUFJLE1BQU0sQ0FBQTtRQUNuQixNQUFNLFFBQVEsR0FBRyxDQUFDLEdBQUcsRUFBQyxFQUFFLENBQUEsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUMsS0FBSyxDQUFDLENBQUE7UUFDM0MsR0FBRyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQsTUFBTSxDQUFDLEdBQUc7UUFDUixNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ3ZCLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUMxQixDQUFDO0lBRUQsUUFBUTtRQUNOLE9BQU8sR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ2hDLENBQUM7SUFFRCxHQUFHLENBQUMsQ0FBQyxFQUFFLFNBQVU7UUFDZixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBQyxTQUFTLENBQUMsQ0FBQTtRQUN2QyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBRSxFQUFFLENBQUUsQ0FBQztRQUN2QixJQUFHLElBQUksQ0FBQyxNQUFNLEVBQUM7WUFDYixPQUFNLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFDLElBQUks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QUFFLENBQUMsR0FBQyxHQUFHLEdBQUMsQ0FBQyxVQUFTLENBQUMsSUFBRSxJQUFJLENBQUMsR0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUMsQ0FBQyxHQUFDLElBQUksRUFBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUEsSUFBSSxFQUFFLEdBQUcsQ0FBQyxHQUFDLEVBQUUsQ0FBQSxDQUFDLENBQUEsR0FBRyxHQUFDLENBQUMsQ0FBQSxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUEsQ0FBQyxHQUFHLENBQUMsSUFBRSxFQUFFLENBQUEsQ0FBQyxDQUFBLENBQUMsQ0FBQyxHQUFDLElBQUksRUFBQyxDQUFDLEdBQUMsRUFBRSxJQUFFLEVBQUUsQ0FBQyxDQUFBLENBQUMsQ0FBQSxDQUFDLElBQUUsQ0FBQyxDQUFBLENBQUMsQ0FBQSxFQUFFLENBQUEsQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFBLE9BQU8sQ0FBQyxHQUFHLEdBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUMsR0FBRyxHQUFDLENBQUMsR0FBRyxHQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFDLEdBQUcsR0FBQyxDQUFDLENBQUEsQ0FBQSxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLENBQUE7QUFDN1QsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuQEluamVjdGFibGUoKSBleHBvcnQgY2xhc3MgRXJyb3JMb2d7XG4gIHB1YmxpYyBsb2cgPSBbXVxuICBwdWJsaWMgbWF4TG9nID0gMzBcblxuICBtb25pdG9yV2luZG93KHdpbj8pe1xuICAgIHdpbiA9IHdpbiB8fCB3aW5kb3dcbiAgICBjb25zdCBjYWxsYmFjayA9IChldnQpPT50aGlzLmFkZChldnQsZmFsc2UpXG4gICAgd2luLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgY2FsbGJhY2spO1xuICB9XG5cbiAgcmVqZWN0KGVycil7XG4gICAgY29uc3QgZSA9IHRoaXMuYWRkKGVycilcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZSlcbiAgfVxuXG4gIHJlamVjdG9yKCl7XG4gICAgcmV0dXJuIGVyciA9PiB0aGlzLnJlamVjdChlcnIpXG4gIH1cblxuICBhZGQoZSwgdG9Db25zb2xlPyl7XG4gICAgY29uc3Qgb2IgPSB0aGlzLnBhcmFtQXVkaXQoZSx0b0NvbnNvbGUpXG4gICAgdGhpcy5sb2cudW5zaGlmdCggb2IgKTtcbiAgICBpZih0aGlzLm1heExvZyl7XG4gICAgICB3aGlsZSh0aGlzLmxvZy5sZW5ndGg+dGhpcy5tYXhMb2cpe1xuICAgICAgICB0aGlzLmxvZy5wb3AoKS8vcmVtb3ZlIGxhc3RcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGxvZ09iVG9FcnJvck9iamVjdChvYilcbiAgfVxuXG4gIC8vYXBpIGVycm9yIHRvIGpzIEVycm9yIG9iamVjdFxuICBwYXJhbUF1ZGl0KGU6IGFueSwgdG9Db25zb2xlPyl7XG4gICAgaWYoZS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgIGUgPSBuZXcgRXJyb3IoZSBhcyBzdHJpbmcpO1xuICAgIH1cblxuICAgIGlmKHRvQ29uc29sZT09bnVsbCB8fCB0b0NvbnNvbGUpY29uc29sZS5lcnJvcihlKVxuXG4gICAgY29uc3QgZXJyID0gdGhpcy5vYmplY3RpZnlFcnJvcihlKTtcbiAgICBlcnJbJ2RhdGV0aW1lJ10gPSBlcnJbJ2RhdGV0aW1lJ118fGdldERhdGVUaW1lU3RyaW5nKClcblxuICAgIGlmKCFlLm1lc3NhZ2UgJiYgZS5zdGF0dXM9PS0xKXtcbiAgICAgIGUubWVzc2FnZSA9IFwiQ2Fubm90IGNvbm5lY3QgdG8gc2VydmVyXCJcbiAgICAgIGUuZGV0YWlscyA9IGUuZGV0YWlscyB8fCBcIkNvbm5lY3Rpb24gdG8gaW50ZXJuZXQgbWF5YmUgZG93bi4gQWxzbyBwb3NzaWJsZSBDT1JTIG5lZWRzIGJlIHRvIGVuYWJsZWQgYXQgcmVtb3RlIHNlcnZlci5cIlxuICAgIH1cblxuICAgIHJldHVybiBlcnJcbiAgfVxuXG4gIC8qKiBDb252ZXJ0IEVycm9yIG9iamVjdCB0byBhIHJlZ3VsYXIgb2JqZWN0ICovXG4gIG9iamVjdGlmeUVycm9yKGVycil7XG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGVycilcbiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgT2JqZWN0LmtleXMoZXJyKSlcblxuICAgIGNvbnN0IHJlY0Vycjp7ZGF0YT86YW55fSA9IHt9Ly9uZXcgRXJyb3IoZXJyLm1lc3NhZ2UgfHwgZXJyLm5hbWUgfHwgZXJyLnR5cGUgfHwgJ1VuZXhwZWN0ZWQgRXJyb3IgT2NjdXJlZCcpXG4gICAga2V5cy5mb3JFYWNoKHY9PnJlY0Vyclt2XT1lcnJbdl0pXG5cbiAgICBjb25zdCBrbm93bktleXMgPSBbXCJzdGFja1wiLFwibWVzc2FnZVwiLFwibmFtZVwiLFwiYXJndW1lbnRzXCIsXCJ0eXBlXCJdXG4gICAga25vd25LZXlzLmZvckVhY2goa2V5PT57XG4gICAgICBpZih0eXBlb2YgZXJyW2tleV0hPSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmVjRXJyW2tleV0gPSBlcnJba2V5XVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBib2R5ID0gZXJyLmJvZHkgfHwgZXJyLl9ib2R5XG5cbiAgICAvL2F1dG8gYXR0ZW1wdCB0byBwYXJzZSBib2R5XG4gICAgaWYoYm9keSAmJiAhZXJyLmRhdGEgJiYgZXJyLmhlYWRlcnMpe1xuICAgICAgY29uc3QgY29udGVudFR5cGUgPSBlcnIuaGVhZGVycy5nZXQoJ2NvbnRlbnQtdHlwZScpXG4gICAgICBpZihjb250ZW50VHlwZSAmJiBjb250ZW50VHlwZS50b0xvd2VyQ2FzZSgpPT0nYXBwbGljYXRpb24vanNvbicpe1xuICAgICAgICB0cnl7XG4gICAgICAgICAgICByZWNFcnIuZGF0YSA9IEpTT04ucGFyc2UoYm9keSlcbiAgICAgICAgfWNhdGNoKGUpe31cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVjRXJyXG4gIH1cblxuICAvKiogc2FtZSBhcyByZWplY3QgYnV0IHVzZXMgbmF0aXZlIHRocm93IGluc3RlYWQgb2YgbmF0aXZlIFByb21pc2UucmVqZWN0ICovXG4gIHJldGhyb3coZXJyKXtcbiAgICBjb25zdCBlID0gdGhpcy5hZGQoZXJyKVxuICAgIHRocm93IGVcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRFcnJvck1lc3NhZ2UoZXJyKXtcbiAgcmV0dXJuIGVyci5tZXNzYWdlIHx8IGVyci5zdGF0dXNUZXh0IHx8IGVyci5uYW1lIHx8ICdVbmV4cGVjdGVkIEVycm9yIE9jY3VyZWQnXG59XG5cbmZ1bmN0aW9uIGdldFJlc3BvbnNlTWVzc2FnZShyZXMpe1xuICBpZihyZXMuZGF0YSAmJiByZXMuZGF0YS5lcnJvciAmJiByZXMuZGF0YS5lcnJvci5tZXNzYWdlKXtcbiAgICByZXR1cm4gcmVzLmRhdGEuZXJyb3IubWVzc2FnZVxuICB9XG4gICAgcmV0dXJuIGdldEVycm9yTWVzc2FnZShyZXMpXG59XG5cbmZ1bmN0aW9uIGxvZ09iVG9FcnJvck9iamVjdChsb2cpe1xuICBjb25zdCBlID0gbmV3IEVycm9yKCBnZXRSZXNwb25zZU1lc3NhZ2UobG9nKSApXG4gIE9iamVjdC5rZXlzKGxvZykuZm9yRWFjaCggdj0+ZVt2XT1sb2dbdl0gKVxuICByZXR1cm4gZVxufVxuXG5mdW5jdGlvbiBnZXREYXRlVGltZVN0cmluZygpe1xuICByZXR1cm4gKGZ1bmN0aW9uKGQpe3JldHVybiAoKCcwJysoZC5nZXRNb250aCgpKzEpKS5zbGljZSgtMikrJy8nKygnMCcrZC5nZXREYXRlKCkpLnNsaWNlKC0yKSsnLycrZC5nZXRGdWxsWWVhcigpKX0pKG5ldyBEYXRlKCkpKycgJysoZnVuY3Rpb24oZCl7dmFyIGg9ZC5nZXRIb3VycygpLHQ9J0FNJyxtPWQuZ2V0TWludXRlcygpO3ZhciBtbiA9IG08MTA/JzAnK206bTtoID0gaD49MTI/KHQ9J1BNJyxoLTEyfHwxMik6aD09MD8xMjpoO3JldHVybiAoJzAnK2gpLnNsaWNlKC0yKSsnOicrKCcwJyttbikuc2xpY2UoLTIpKycgJyt0fSkobmV3IERhdGUoKSlcbn0iXX0=