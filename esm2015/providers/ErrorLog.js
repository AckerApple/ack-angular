import { Injectable } from '@angular/core';
export class ErrorLog {
    constructor() {
        this.log = [];
        this.maxLog = 30;
    }
    monitorWindow(win) {
        win = win || window;
        const callback = (evt) => this.add(evt, false);
        win.addEventListener('error', callback);
    }
    reject(err) {
        const e = this.add(err);
        return Promise.reject(e);
    }
    rejector() {
        return (err) => this.reject(err);
    }
    add(e, toConsole) {
        const ob = this.paramAudit(e, toConsole);
        this.log.unshift(ob);
        if (this.maxLog) {
            while (this.log.length > this.maxLog) {
                this.log.pop(); //remove last
            }
        }
        return logObToErrorObject(ob);
    }
    //api error to js Error object
    paramAudit(e, toConsole) {
        if (e.constructor === String) {
            e = new Error(e);
        }
        if (toConsole == null || toConsole)
            console.error(e);
        const err = this.objectifyError(e);
        err['datetime'] = err['datetime'] || getDateTimeString();
        if (!e.message && e.status == -1) {
            e.message = "Cannot connect to server";
            e.details = e.details || "Connection to internet maybe down. Also possible CORS needs be to enabled at remote server.";
        }
        return err;
    }
    /** Convert Error object to a regular object */
    objectifyError(err) {
        const keys = Object.getOwnPropertyNames(err);
        keys.push.apply(keys, Object.keys(err));
        const recErr = {}; //new Error(err.message || err.name || err.type || 'Unexpected Error Occured')
        keys.forEach(v => recErr[v] = err[v]);
        const knownKeys = ["stack", "message", "name", "arguments", "type"];
        knownKeys.forEach(key => {
            if (typeof err[key] != 'undefined') {
                recErr[key] = err[key];
            }
        });
        const body = err.body || err._body;
        //auto attempt to parse body
        if (body && !err.data && err.headers) {
            const contentType = err.headers.get('content-type');
            if (contentType && contentType.toLowerCase() == 'application/json') {
                try {
                    recErr.data = JSON.parse(body);
                }
                catch (e) { }
            }
        }
        return recErr;
    }
    /** same as reject but uses native throw instead of native Promise.reject */
    rethrow(err) {
        const e = this.add(err);
        throw e;
    }
}
ErrorLog.decorators = [
    { type: Injectable }
];
function getErrorMessage(err) {
    return err.message || err.statusText || err.name || 'Unexpected Error Occured';
}
function getResponseMessage(res) {
    if (res.data && res.data.error && res.data.error.message) {
        return res.data.error.message;
    }
    return getErrorMessage(res);
}
function logObToErrorObject(log) {
    const e = new Error(getResponseMessage(log));
    Object.keys(log).forEach(v => e[v] = log[v]);
    return e;
}
function getDateTimeString() {
    return (function (d) { return (('0' + (d.getMonth() + 1)).slice(-2) + '/' + ('0' + d.getDate()).slice(-2) + '/' + d.getFullYear()); })(new Date()) + ' ' + (function (d) { var h = d.getHours(), t = 'AM', m = d.getMinutes(); var mn = m < 10 ? '0' + m : m; h = h >= 12 ? (t = 'PM', h - 12 || 12) : h == 0 ? 12 : h; return ('0' + h).slice(-2) + ':' + ('0' + mn).slice(-2) + ' ' + t; })(new Date());
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXJyb3JMb2cuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcHJvdmlkZXJzL0Vycm9yTG9nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFN0IsTUFBTSxPQUFPLFFBQVE7SUFBbkM7UUFDUyxRQUFHLEdBQVUsRUFBRSxDQUFBO1FBQ2YsV0FBTSxHQUFHLEVBQUUsQ0FBQTtJQWtGcEIsQ0FBQztJQWhGQyxhQUFhLENBQUMsR0FBUztRQUNyQixHQUFHLEdBQUcsR0FBRyxJQUFJLE1BQU0sQ0FBQTtRQUNuQixNQUFNLFFBQVEsR0FBRyxDQUFDLEdBQVEsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUMsS0FBSyxDQUFDLENBQUE7UUFDbEQsR0FBRyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQsTUFBTSxDQUFDLEdBQVE7UUFDYixNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ3ZCLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUMxQixDQUFDO0lBRUQsUUFBUTtRQUNOLE9BQU8sQ0FBQyxHQUFRLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDdkMsQ0FBQztJQUVELEdBQUcsQ0FBQyxDQUFNLEVBQUUsU0FBZTtRQUN6QixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBQyxTQUFTLENBQUMsQ0FBQTtRQUN2QyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBRSxFQUFFLENBQUUsQ0FBQztRQUN2QixJQUFHLElBQUksQ0FBQyxNQUFNLEVBQUM7WUFDYixPQUFNLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxH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QUksSUFBSSxFQUFFLENBQUMsR0FBQyxHQUFHLEdBQUMsQ0FBQyxVQUFTLENBQUMsSUFBRSxJQUFJLENBQUMsR0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLEVBQUMsQ0FBQyxHQUFDLElBQUksRUFBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUEsSUFBSSxFQUFFLEdBQUcsQ0FBQyxHQUFDLEVBQUUsQ0FBQSxDQUFDLENBQUEsR0FBRyxHQUFDLENBQUMsQ0FBQSxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUEsQ0FBQyxHQUFHLENBQUMsSUFBRSxFQUFFLENBQUEsQ0FBQyxDQUFBLENBQUMsQ0FBQyxHQUFDLElBQUksRUFBQyxDQUFDLEdBQUMsRUFBRSxJQUFFLEVBQUUsQ0FBQyxDQUFBLENBQUMsQ0FBQSxDQUFDLElBQUUsQ0FBQyxDQUFBLENBQUMsQ0FBQSxFQUFFLENBQUEsQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFBLE9BQU8sQ0FBQyxHQUFHLEdBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUMsR0FBRyxHQUFDLENBQUMsR0FBRyxHQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFDLEdBQUcsR0FBQyxDQUFDLENBQUEsQ0FBQSxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLENBQUE7QUFDN1QsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuQEluamVjdGFibGUoKSBleHBvcnQgY2xhc3MgRXJyb3JMb2d7XG4gIHB1YmxpYyBsb2c6IGFueVtdID0gW11cbiAgcHVibGljIG1heExvZyA9IDMwXG5cbiAgbW9uaXRvcldpbmRvdyh3aW4/OiBhbnkpe1xuICAgIHdpbiA9IHdpbiB8fCB3aW5kb3dcbiAgICBjb25zdCBjYWxsYmFjayA9IChldnQ6IGFueSkgPT4gdGhpcy5hZGQoZXZ0LGZhbHNlKVxuICAgIHdpbi5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGNhbGxiYWNrKTtcbiAgfVxuXG4gIHJlamVjdChlcnI6IGFueSl7XG4gICAgY29uc3QgZSA9IHRoaXMuYWRkKGVycilcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZSlcbiAgfVxuXG4gIHJlamVjdG9yKCl7XG4gICAgcmV0dXJuIChlcnI6IGFueSkgPT4gdGhpcy5yZWplY3QoZXJyKVxuICB9XG5cbiAgYWRkKGU6IGFueSwgdG9Db25zb2xlPzogYW55KXtcbiAgICBjb25zdCBvYiA9IHRoaXMucGFyYW1BdWRpdChlLHRvQ29uc29sZSlcbiAgICB0aGlzLmxvZy51bnNoaWZ0KCBvYiApO1xuICAgIGlmKHRoaXMubWF4TG9nKXtcbiAgICAgIHdoaWxlKHRoaXMubG9nLmxlbmd0aD50aGlzLm1heExvZyl7XG4gICAgICAgIHRoaXMubG9nLnBvcCgpLy9yZW1vdmUgbGFzdFxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbG9nT2JUb0Vycm9yT2JqZWN0KG9iKVxuICB9XG5cbiAgLy9hcGkgZXJyb3IgdG8ganMgRXJyb3Igb2JqZWN0XG4gIHBhcmFtQXVkaXQoZTogYW55LCB0b0NvbnNvbGU/OiBhbnkpe1xuICAgIGlmKGUuY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG4gICAgICBlID0gbmV3IEVycm9yKGUgYXMgc3RyaW5nKTtcbiAgICB9XG5cbiAgICBpZih0b0NvbnNvbGU9PW51bGwgfHwgdG9Db25zb2xlKWNvbnNvbGUuZXJyb3IoZSlcblxuICAgIGNvbnN0IGVyciA9IHRoaXMub2JqZWN0aWZ5RXJyb3IoZSk7XG4gICAgZXJyWydkYXRldGltZSddID0gZXJyWydkYXRldGltZSddfHxnZXREYXRlVGltZVN0cmluZygpXG5cbiAgICBpZighZS5tZXNzYWdlICYmIGUuc3RhdHVzPT0tMSl7XG4gICAgICBlLm1lc3NhZ2UgPSBcIkNhbm5vdCBjb25uZWN0IHRvIHNlcnZlclwiXG4gICAgICBlLmRldGFpbHMgPSBlLmRldGFpbHMgfHwgXCJDb25uZWN0aW9uIHRvIGludGVybmV0IG1heWJlIGRvd24uIEFsc28gcG9zc2libGUgQ09SUyBuZWVkcyBiZSB0byBlbmFibGVkIGF0IHJlbW90ZSBzZXJ2ZXIuXCJcbiAgICB9XG5cbiAgICByZXR1cm4gZXJyXG4gIH1cblxuICAvKiogQ29udmVydCBFcnJvciBvYmplY3QgdG8gYSByZWd1bGFyIG9iamVjdCAqL1xuICBvYmplY3RpZnlFcnJvcihlcnI6IGFueSl7XG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGVycilcbiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgT2JqZWN0LmtleXMoZXJyKSlcblxuICAgIGNvbnN0IHJlY0Vycjp7ZGF0YT86YW55fSA9IHt9Ly9uZXcgRXJyb3IoZXJyLm1lc3NhZ2UgfHwgZXJyLm5hbWUgfHwgZXJyLnR5cGUgfHwgJ1VuZXhwZWN0ZWQgRXJyb3IgT2NjdXJlZCcpXG4gICAga2V5cy5mb3JFYWNoKHY9PnJlY0Vyclt2XT1lcnJbdl0pXG5cbiAgICBjb25zdCBrbm93bktleXMgPSBbXCJzdGFja1wiLFwibWVzc2FnZVwiLFwibmFtZVwiLFwiYXJndW1lbnRzXCIsXCJ0eXBlXCJdXG4gICAga25vd25LZXlzLmZvckVhY2goa2V5PT57XG4gICAgICBpZih0eXBlb2YgZXJyW2tleV0hPSd1bmRlZmluZWQnKXtcbiAgICAgICAgcmVjRXJyW2tleV0gPSBlcnJba2V5XVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zdCBib2R5ID0gZXJyLmJvZHkgfHwgZXJyLl9ib2R5XG5cbiAgICAvL2F1dG8gYXR0ZW1wdCB0byBwYXJzZSBib2R5XG4gICAgaWYoYm9keSAmJiAhZXJyLmRhdGEgJiYgZXJyLmhlYWRlcnMpe1xuICAgICAgY29uc3QgY29udGVudFR5cGUgPSBlcnIuaGVhZGVycy5nZXQoJ2NvbnRlbnQtdHlwZScpXG4gICAgICBpZihjb250ZW50VHlwZSAmJiBjb250ZW50VHlwZS50b0xvd2VyQ2FzZSgpPT0nYXBwbGljYXRpb24vanNvbicpe1xuICAgICAgICB0cnl7XG4gICAgICAgICAgICByZWNFcnIuZGF0YSA9IEpTT04ucGFyc2UoYm9keSlcbiAgICAgICAgfWNhdGNoKGUpe31cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVjRXJyXG4gIH1cblxuICAvKiogc2FtZSBhcyByZWplY3QgYnV0IHVzZXMgbmF0aXZlIHRocm93IGluc3RlYWQgb2YgbmF0aXZlIFByb21pc2UucmVqZWN0ICovXG4gIHJldGhyb3coZXJyOiBhbnkpe1xuICAgIGNvbnN0IGUgPSB0aGlzLmFkZChlcnIpXG4gICAgdGhyb3cgZVxuICB9XG59XG5cbmZ1bmN0aW9uIGdldEVycm9yTWVzc2FnZShlcnI6IGFueSl7XG4gIHJldHVybiBlcnIubWVzc2FnZSB8fCBlcnIuc3RhdHVzVGV4dCB8fCBlcnIubmFtZSB8fCAnVW5leHBlY3RlZCBFcnJvciBPY2N1cmVkJ1xufVxuXG5mdW5jdGlvbiBnZXRSZXNwb25zZU1lc3NhZ2UocmVzOiBhbnkpe1xuICBpZihyZXMuZGF0YSAmJiByZXMuZGF0YS5lcnJvciAmJiByZXMuZGF0YS5lcnJvci5tZXNzYWdlKXtcbiAgICByZXR1cm4gcmVzLmRhdGEuZXJyb3IubWVzc2FnZVxuICB9XG4gICAgcmV0dXJuIGdldEVycm9yTWVzc2FnZShyZXMpXG59XG5cbmZ1bmN0aW9uIGxvZ09iVG9FcnJvck9iamVjdChsb2c6IGFueSl7XG4gIGNvbnN0IGUgPSBuZXcgRXJyb3IoIGdldFJlc3BvbnNlTWVzc2FnZShsb2cpIClcbiAgT2JqZWN0LmtleXMobG9nKS5mb3JFYWNoKCB2PT5lW3ZdPWxvZ1t2XSApXG4gIHJldHVybiBlXG59XG5cbmZ1bmN0aW9uIGdldERhdGVUaW1lU3RyaW5nKCl7XG4gIHJldHVybiAoZnVuY3Rpb24oZCl7cmV0dXJuICgoJzAnKyhkLmdldE1vbnRoKCkrMSkpLnNsaWNlKC0yKSsnLycrKCcwJytkLmdldERhdGUoKSkuc2xpY2UoLTIpKycvJytkLmdldEZ1bGxZZWFyKCkpfSkobmV3IERhdGUoKSkrJyAnKyhmdW5jdGlvbihkKXt2YXIgaD1kLmdldEhvdXJzKCksdD0nQU0nLG09ZC5nZXRNaW51dGVzKCk7dmFyIG1uID0gbTwxMD8nMCcrbTptO2ggPSBoPj0xMj8odD0nUE0nLGgtMTJ8fDEyKTpoPT0wPzEyOmg7cmV0dXJuICgnMCcraCkuc2xpY2UoLTIpKyc6JysoJzAnK21uKS5zbGljZSgtMikrJyAnK3R9KShuZXcgRGF0ZSgpKVxufSJdfQ==